{
    "contents" : "\\documentclass{article}\n\n\\usepackage[utf8]{inputenc}\n\\usepackage{mdwlist}\n\\usepackage[inner=3cm,outer=4cm]{geometry}\n\\usepackage{mathtools}\n\n\\begin{document}\n\\SweaveOpts{concordance=TRUE}\n\n\\title{Homework 08. Zero-inflated Poisson and Logistic Regression. PLS206 Fall 2014}\n\\author{Emilio A. Laca}\n\\maketitle\n\n\n\\Section Zero Inflated Poisson\n\\section{Data}\n\nThis exercise uses simulated data similar to those data used in HW07F14. Thus, we know the true model and whether the assumptions are met. The data simulate the number of individuals of a relatively rare mammal observed in a series of locations in East Africa. Locations were selected haphazardly. Variables measured at each location were:\n\n\\begin{description*}\n  \\item[nrrm] number of individuals of the relatively rare mammal seen.\n  \\item[river] distance to the nearest river in km.\n  \\item[tveg] vegetation type (sg: short grass, tg: tall grass, sh: shrubs, wl: woodland, svn: savanna )\n  \\item[road] distance to nearest road in km.\n  \\item[cover] visual cover; proportion of a vertical surface visible from 20 m.\n\\end{description*}\n\nThe data simulation code is presented for completeness, but for the analysis we use a preset simulation that remains constant across compilations of this document. Note that this simulation includes zero inflation.\n<<datasim>>=\ndsim <- data.frame(river = round(runif(150, min=0.5, max=15),1),\n                 tveg = rep(c(\"sg\",\"tg\",\"sh\",\"wl\",\"svn\"),each=30),\n                 road = round(rchisq(150, 6),1),\n                 cover = c(\n                   rbeta(30,2,10),\n                   rbeta(30,4,8),\n                   rbeta(30,10,3),\n                   rbeta(30,8,4),\n                   rbeta(30,6,6)))\nbeta0 <- 0.05\nbRiver <- -0.1\nbRoad <- 0.05\nbRiverRoad <- 0.02\nbCover <- 2\n# count component\ndsim$nrrm <- rpois(150,\n                 exp(beta0 +\n                     bRiver*dsim$river +\n                     bRoad*dsim$road +\n                     bRiverRoad*dsim$river*dsim$road +\n                     bCover*dsim$cover))\n# zero component\ngamma0 <- 10\ngamma1 <- -2\ndsim$is.zero <- rbinom(150,1,exp(gamma0+gamma1*dsim$road)/(1+exp(gamma0+gamma1*dsim$road)))\ndsim$nrrm <- dsim$nrrm*dsim$is.zero\nwrite.csv(dsim,\"../Examples/zeroinfl.txt\")\n@\n\n\\section{Data exploration}\nWe start with the hypothesis that the species will be more abundant in grassland areas with good cover close to rivers and far from roads. We plot the data against each predictor.\n\n<<explore, fig=TRUE>>=\nd1 <- read.csv(\"../Examples/dataHW08F14.txt\", header=TRUE)\nlibrary(car)\nlibrary(ggplot2)\npar(mfrow=c(3,1))\nscatterplot(nrrm ~ river | tveg, data=d1)\nscatterplot(nrrm ~ road | tveg, data=d1)\nscatterplot(nrrm ~ cover | tveg, data=d1)\npairs(d1)\n@\n\nThere are clear trends in the plots for cover and roads, but the effect of distance to rivers appears weak. This may be a result of the variability that masks the effects. A model will \"clean up\" the variability and make it easier to see patterns. Cover is clearly related to vegetation type. This collinearity may make it difficult to pick the correct \"causal\" factor.\n\n\n\\section{Modeling}\nThe number of individuals counted is a positive discrete variable. There is no limit to the potential number of individuals found. We start with a distribution that accommodates both properties, the Poisson distribution. We must take into account the fact that there are 100 observations, thus, we should not entertain models with more than 15 degrees of freedom.\n\n<<glm1,fig=TRUE>>=\nm1 <- glm(nrrm~cover+tveg+river+road, family=\"poisson\", data=d1)\nm1\nsummary(m1)\nAnova(m1, test=\"Wald\", type=3)\nanova(m1, test=\"Chisq\")\ndeviance(m1)\npar(mfrow=c(2,2))\nplot(m1)\nvif(m1)\n@\n\nThe anova() and Anova() tests show that vegetation type tveg is not significant if it is not entered before cover. The pairs() plots had shown that cover was highly correlated with vegetation type. The same results can be obtained using the drop1() function.\n\n<<glm2>>=\ndrop1(m1)\nm2 <- glm(nrrm~cover+river+road, family=\"poisson\", data=d1)\nm2\nsummary(m2)\nAnova(m2, test=\"Wald\", type=3)\n@\n\nThe AIC actually declines when we drop tveg from the model. We have strong evidence that tveg is not necessary as a predictor. We drop tveg and explore the residuals to determine if other terms are necessary. The type III tests show that cover, river and road are significant.\n\n<<glm2plot, fig=TRUE>>=\nplot(m2)\nplot(residuals(m2),d1$cover)\nplot(residuals(m2),d1$river)\nplot(residuals(m2),d1$road)\nplot(residuals(m2)~d1$tveg)\n@\n\nThe plots do not reveal heterogeneit of variance or patterns that need to be addressed. However, we check for two way interactions, because -for example- we expect that the effect of cover depends on the distance to roads, etc.\n\n<<glm3, fig=TRUE>>=\nm3 <- glm(nrrm~(cover+river+road)^2, family=\"poisson\", data=d1)\nAnova(m3, type=3)\nsummary(m3)\nplot(m3)\ndrop1(m3, test=\"Chisq\")\n@\n\nLooks like dropping cover*road will imporve the model. The new model m5 has all the right terms.\n\n<<glm4, fig=TRUE>>=\nm4 <- glm(nrrm~cover+river+road+cover:river+road:river, family=poisson(), data=d1)\nm4\nsummary(m4)\nAnova(m4, type=3)\ndrop1(m4,test=\"Chisq\")\nm5 <- glm(nrrm~cover+river+road+cover:river, family=poisson, data=d1)\nsummary(m5)\nanova(m5, test=\"Chisq\")\npar(mfrow=c(2,2))\nplot(m5)\nresidualPlot(m5)\nanova(m4,m5, test=\"Chisq\")\n@\n\nThis model include all the seemingly important factors, but it may have a problem of overdispersion. Overdispersion refers to the violation of the implicit assumption that the mean is equal to the variance for Poisson distributed data. If the assumption is true, then the residual deviance should have a $\\chi^2$ distribution with n-p = 95 df. The value of \\Sexpr{round(deviance(m5),2)} with 95 df has a probability of \\Sexpr{round(1-pchisq(deviance(m5),95),3)}, which is suggestive of overdispersion.\n\nTo test for overdispersion we fit a model using the quasipoisson family, which has one additional parameter to allow for a variance that is greater (by a constant factor) than the mean. Technically, the model development should be repeated with the new approach, but here we just test for overdispersion. The package AER has a function \\verb!dispersiontest()! that performs a test of significance of overdispersion.\n<<>>=\nlibrary(AER)\ndispersiontest(m5, trafo=1)\n@\n\nThe test indicates that there is no overdispersion, which is consistent with the fact that data were actually Poisson distributed.\n\n<<fig=TRUE>>=\n# Predictions for various levels of cover and distance to river at average level of road\nmean(d1$road)\nrange(d1$river)\nrange(d1$cover)\np.data <- expand.grid(cover=seq(0.04,0.94,by=0.05), river=c(0,5,10,15),road=c(2,20))\np.data$nrrm <- predict(m5,newdata=p.data, type=\"response\")\n\nggplot(p.data, aes(x = cover, y = nrrm, colour = factor(river))) +\n  geom_point() +\n  geom_line() +\n  facet_wrap(~road) +\n  labs(x = \"Cover\", y = \"Predicted number of rare mammal\")\n@\n\n\n\n\n\n\n\n\\end{document}",
    "created" : 1417908247126.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2169252685",
    "id" : "34E13F8B",
    "lastKnownWriteTime" : 1417917297,
    "path" : "~/Google Drive/PLS206F13/RstudioPLS206/HW08ZIPlogistic.Rnw",
    "project_path" : "HW08ZIPlogistic.Rnw",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "sweave"
}